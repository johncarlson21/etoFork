/*
* jQuery SFBrowser
*
* Version: 3.3.2
*
* Copyright (c) 2010 Ron Valstar http://www.sjeiti.com/
*
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*/
(function($){var oSettings={};var ss=oSettings;var aSort=[];var iSort=0;var bHasImgs=false;var aPath=[];var oTree={};var bOverlay=false;var sFolder;var sReturnPath;var oConstraint;var sBodyOverflow="auto";var bIsOpen=false;var bShortcutsDisabled=false;var $Document=$(document);var $Window;var $Body;var $SFB;var $SFBWin;var $TableH;var $Table;var $TbBody;var $TrLoading;var $Context;var $Focused;var $CopyPath;var oDragTr;var $DragTr;var $DragTrTable;var oCookie;var oMaximized;var oReg={fileNameNoExt:/(.*)[\/\\]([^\/\\]+)\.\w+$/,fileNameWiExt:/(.*)[\/\\]([^\/\\]+\.\w+)$/};$.sfbrowser={id:"SFBrowser",version:"3.3.2",copyright:"Copyright (c) 2007 - 2011 Ron Valstar",uri:"http://sfbrowser.sjeiti.com/",defaults:{title:"",select:function(a){trace(a)},selectparams:null,selectnum:0,file:"",folder:"",dirs:true,upload:true,swfupload:false,allow:[],resize:null,inline:"body",fixed:false,cookie:false,preview:true,copyRelative:false,bgcolor:"#000",bgalpha:0.5,x:null,y:null,w:640,h:480,img:["gif","jpg","jpeg","png"],ascii:["txt","xml","html","htm","eml","ffcmd","js","as","php","css","java","cpp","pl","log"],movie:["mp3","mp4","m4v","m4a","3gp","mov","flv","f4v"],archive:["zip","rar"],sfbpath:"sfbrowser/",base:"../data/",prefx:"",deny:[],previewbytes:600,connector:"php",lang:{},plugins:[],maxsize:2097152,debug:false},addLang:function(oLang){for(var sId in oLang){$.sfbrowser.defaults.lang[sId]=oLang[sId]}},swfInit:function(){trace("swfInit")},ufileSelected:function(s){trace("ufileSelected: ",s);var bPrcd=true;if(getPath().contents[s]!==undefined&&!confirm(gettext("fileExistsOverwrite"))){bPrcd=false}if(bPrcd){$("#swfUploader").get(0).doUpload(s)}else{$("#swfUploader").get(0).cancelUpload(s)}},ufileTooBig:function(s){alert(gettext("fileTooBig").replace("#1",s).replace("#2",format_size(oSettings.maxsize,0)))},ufileOpen:function(s){trace("ufileOpen: ",s);var oExists=getPath().contents[s];if(oExists){oExists.tr.remove()}var mTr=listAdd({file:s,mime:"upload",rsize:0,size:"",time:0,date:"",width:0,height:0}).addClass("uploading")},ufileProgress:function(f,s){var oExists=getPath().contents[s];var mPrg=oExists.tr.find(".progress");var sPerc=Math.round(f*100)+"%";mPrg.find("span").text(sPerc);mPrg.find("div").css({width:sPerc})},ufileCompleteD:function(o){trace("ufileCompleteD: ",o);getPath().contents[o.data.file].tr.remove();listAdd(o.data,1).trigger("click")},getPath:function(){trace("getPath");$("#swfUploader").get(0).setPath(aPath.join(""))}};$(function(){log($.sfbrowser.id+" "+$.sfbrowser.version)});$.fn.extend({sfbrowser:function(_settings){$.extend(oSettings,$.sfbrowser.defaults,_settings);ss.connbase="connectors/"+ss.connector+"/sfbrowser."+ss.connector;ss.conn=ss.prefx+ss.sfbpath+ss.connbase;trace("oSettings.conn: ",oSettings,this);if(ss.debug){$.sfbrowser.tree=oTree;$.sfbrowser.path=aPath}$Window=$(window);$Body=$("body");oConstraint={mnx:0,mny:0,mxx:$Window.width()-ss.w,mxy:$Window.height()-ss.h,mnw:244,mnh:275,mxw:$Window.width(),mxh:$Window.height()};getSfbCookie();aSort=[];bHasImgs=ss.allow.length===0||unique(copy(ss.img).concat(ss.allow)).length<(ss.allow.length+ss.img.length);aPath=[];sFolder=ss.base+ss.folder;bOverlay=ss.inline=="body";if(bOverlay){ss.fixed=false}if(oCookie&&oCookie.path&&oCookie.path.length>0){if(sFolder==oCookie.path[0]){aPath=oCookie.path;sFolder=aPath.pop()}}var aFxSfbpath=ss.sfbpath.split("/");var aFxBase=ss.base.split("/");var iFxLen=Math.min(aFxBase.length,aFxSfbpath.length);var iDel=0;for(var i=0;i<iFxLen;i++){var sFxFolder=aFxBase[i];if(sFxFolder==".."&&aFxSfbpath.length>0){while(true){var sRem=aFxSfbpath.pop();if(sRem!=""){iDel++;break}}}else{if(sFxFolder!=""){aFxBase=aFxBase.splice(iDel);break}}}sReturnPath=(aFxSfbpath.join("/")+"//"+aFxBase.join("/")).replace(/(\/+)/,"/").replace(/(^\/+)/,"");$SFB=$(ss.browser);$SFBWin=$SFB.find("#fbwin");$TableH=$SFBWin.find("#fbtable");$Table=$TableH.find("table");$TbBody=$Table.find("tbody");$Context=$SFB.find("#sfbcontext");$SFB.find("div.sfbheader>h3").html((ss.title==""?gettext("sfb"):ss.title)+(ss.debug?" <span>debug mode</span>":""));$SFB.find("div#loadbar>span").text(gettext("loading"));$SFB.find("#fileToUpload").change(fileUpload);var $TopA=$SFB.find("ul#sfbtopmenu>li>a");if(ss.dirs){$TopA.filter(".newfolder").click(addFolder).attr("title",gettext("newfolder")).find("span").text(gettext("newfolder"))}else{$TopA.filter(".newfolder").parent().remove()}if(ss.upload){$TopA.filter(".upload").attr("title",gettext("upload")).find("span").text(gettext("upload"))}else{$TopA.filter(".upload").parent().remove()}if(!ss.fixed){$TopA.filter(".cancelfb").click(closeSFB).attr("title",gettext("cancel")).find("span").text(gettext("cancel"))}else{$TopA.filter(".cancelfb").parent().remove()}if(!ss.fixed){$TopA.filter(".maximizefb").click(maximizeSFB).attr("title",gettext("maximize")||"").find("span").text(gettext("maximize")||"")}else{$TopA.filter(".maximizefb").parent().remove()}var mTh=$SFB.find("table#filesDetails>thead>tr>th");mTh.eq(0).text(gettext("name"));mTh.eq(1).text(gettext("type"));mTh.eq(2).text(gettext("size"));mTh.eq(3).text(gettext("date"));mTh.eq(4).text(gettext("dimensions"));if(!bHasImgs){mTh.eq(4).remove()}mTh.filter(":not(:last)").each(function(i,o){$(this).click(function(){sortFbTable(i)})}).append("<span>&nbsp;</span>");if(!ss.preview){$SFB.find("#fbpreview").remove()}trace("ss.preview: ",ss.preview);$SFB.find("div.choose").click(chooseFile).text(gettext("choose"));$SFB.find("div.cancelfb").click(closeSFB).text(gettext("cancel"));if(ss.debug){$('<a href="#" class="clearCookie">clear cookie</a>').appendTo($SFBWin).click(function(e){eraseCookie($.sfbrowser.id);trace("cookie cleared",readCookie($.sfbrowser.id))})}$SFB.find("#sfbfooter").html('<a href="'+$.sfbrowser.uri+'">'+$.sfbrowser.id+" "+$.sfbrowser.version+" &nbsp; &nbsp; &nbsp; &nbsp; "+$.sfbrowser.copyright+"</a>");$TrLoading=$TbBody.find("tr").clone();$SFB.find("#fbbg").css({backgroundColor:ss.bgcolor,opacity:ss.bgalpha,filter:"alpha(opacity="+(100*ss.bgalpha)+")"});var bSFB=$("#sfbrowser").length>0;if(bSFB){$("#sfbrowser").remove()}$SFB.appendTo(ss.inline);if(ss.upload&&!ss.swfupload){setTimeout(function(){$TopA.filter(".upload").css({display:"inline-block",minWidth:$SFB.find("#fileToUpload").width()-20+"px",textAlign:"left"})},1)}addContextItem("choose",gettext("choose"),function(e){chooseFile()});addContextItem("rename",gettext("rename"),function(e){renameAddInputField()});addContextItem("duplicate",gettext("duplicate"),function(e){duplicateFile()});addContextItem("preview",gettext("view"),function(e){$TbBody.find("tr.selected:first a.preview").trigger("click")});addContextItem("filedelete",gettext("del"),function(e){$TbBody.find("tr.selected:first a.filedelete").trigger("click")});$SFB.click(closeContext);$CopyPath=$('<input type="text" />').css({position:"fixed"});if(bOverlay){$Window.bind("resize",resizeBrowser);$SFBWin.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false});$SFB.find("h3").attr("title",gettext("dragMe")).mousedown(moveWindowDown);$SFB.find("div#resizer").attr("title",gettext("dragMe")).mousedown(resizeWindowDown);if(ss.x==null){ss.x=Math.round($Window.width()/2-$SFBWin.width()/2)}if(ss.y==null){ss.y=Math.round($Window.height()/2-$SFBWin.height()/2)}$SFBWin.css({top:ss.y,left:ss.x,width:ss.w,height:ss.h})}else{trace("sfb inline");$SFB.find("#fbbg").remove();$SFB.find("div#resizer").remove();$SFB.find("div.cancelfb").remove();$SFB.css({position:"relative",width:"auto",heigth:"auto"});$SFBWin.css({position:"relative",border:"0px"});var mPrn=$(ss.inline);resizeWindow(0,mPrn.width(),mPrn.height())}setupKeyboardShortcuts();var oThis={trace:trace,openDir:openDir,closeSFB:closeSFB,addContextItem:addContextItem,fillList:fillList,listAdd:listAdd,file:file,getPath:getPath,gettext:gettext,lang:lang,resizeWindowDown:resizeWindowDown,moveWindowDown:moveWindowDown,resizeWindow:resizeWindow,onError:onError,sortFbTable:sortFbTable,shortcutsDisabled:shortcutsDisabled,aPath:aPath,bOverlay:bOverlay,oSettings:ss,oTree:oTree,oReg:oReg,$Document:$Document,$Window:$Window,$Body:$Body,$SFB:$SFB,$SFBWin:$SFBWin,$TableH:$TableH,$Table:$Table,$TbBody:$TbBody,$TrLoading:$TrLoading,$Context:$Context};$.each(ss.plugins,function(i,sPlugin){$.sfbrowser[sPlugin](oThis)});if(ss.swfupload){$("<br/>").animate({foo:1},{duration:1,complete:function(){trace("sfb swfupload init");$SFB.find("#fileio").remove();var mAup=$SFB.find("#sfbtopmenu a.upload");mAup.append('<div id="swfUploader"></div>');swfobject.embedSWF(ss.sfbpath+"uploader.swf","swfUploader",(mAup.width()+10)+"px",mAup.height()+"px","9.0.0","",{debug:ss.debug,maxsize:ss.maxsize,uploadUri:ss.connbase,action:"swfUpload",folder:aPath.join(""),allow:ss.allow.join("|"),deny:ss.deny.join("|"),resize:ss.resize},{menu:"false",wmode:"transparent"})}})}var mUpbut=$SFB.find("form#fileio");var mAUpbut=$SFB.find("#sfbtopmenu a.upload");if(ss.debug){mUpbut.css({opacity:".5",filter:"alpha(opacity=50)"})}$.browser.msie&&$.browser.version>=8&&mUpbut.css({top:"-15px",width:"90px"}).find("input").css({fontSize:"12px"});openDir(sFolder);openSFB();trace("SFBrowser open (",(ss.swfupload?"swf":"normal")," upload, ",ss.plugins,")",true)}});function openSFB(){$SFB.find("#fbbg").slideDown();$SFBWin.slideDown("normal",function(){resizeBrowser();resizeWindow();if(ss.cookie&&!oCookie){setSfbCookie()}});if(bOverlay){sBodyOverflow=$Body.css("overflow");$Body.css({overflow:"hidden"})}bIsOpen=true}function closeSFB(){trace("sfb close");if(ss.cookie){setSfbCookie()}$("#sfbrowser #fbbg").fadeOut();$SFBWin.slideUp("normal",function(){$SFB.remove()});if(bOverlay){$Body.css({overflow:sBodyOverflow}).scrollTop($Body.scrollTop()+1)}bIsOpen=false}function setupKeyboardShortcuts(){var bSFB=$("#sfbrowser").length>0;ss.keys=[];$Window.keydown(keyDown);$Window.keyup(keyUp)}function keyDown(e){trace("keyDown: ",e.keyCode,e);ss.keys[e.keyCode]=true;var SHIFT=ss.keys[16];var CTRL=ss.keys[17];var ALT=ss.keys[18];var iNumDown=0;$.each(ss.keys,function(i,o){if(o){iNumDown++}});if(!shortcutsDisabled()&&bIsOpen&&iNumDown==1&&$TbBody.find("tr>td>input").length==0&&e.keyCode>=65&&e.keyCode<=90){var sChar=("abcdefghijklmnopqrstuvwxyz").substr(e.keyCode-65,1);var mSel=$TbBody.find("tr.selected:first");var aTbr=$TbBody.find("tr");var iInd=aTbr.index(mSel);if(iInd==-1){iInd=0}var iTbr=aTbr.length;for(var i=1;i<iTbr;i++){var mChk=$(aTbr[(i+iInd)%iTbr]);if(mChk.attr("id").substr(0,1).toLowerCase()==sChar){mChk.mouseup(clickTrUp).mouseup();return false}}}switch(e.keyCode){case 13:if(bIsOpen){chooseFile()}break}if(CTRL){var bReturn=false;switch(e.keyCode){case 81:if(bIsOpen){closeSFB()}break;case 65:if(bIsOpen){selectAll()}break;case 70:if(!bIsOpen&&!bSFB){$.sfb(ss)}break;case 67:if(bIsOpen&&$CopyPath.parent().length===0){addCopyPath();setTimeout(remCopyPath,10)}bReturn=true;break;default:bReturn=true}if(bReturn===false){return false}}}function keyUp(e){trace("keyUp: ",e.keyCode,e);if(bIsOpen&&!shortcutsDisabled()&&ss.keys[113]){renameAddInputField()}if(bIsOpen&&ss.keys[27]){closeSFB()}if((e.keyCode===17||e.keyCode===67)&&$CopyPath.parent().length){remCopyPath()}ss.keys[e.keyCode]=false;return false}var selectAll=function selectAll(){$TbBody.find("tr").each(function(){var $Tr=$(this);if(file($Tr).mime!="folderup"&&!$Tr.hasClass("uploading")){$Tr.addClass("selected")}})};var addCopyPath=function addCopyPath(){var $Tr=$TbBody.find("tr.selected:first");if($Tr.length>0){var oExists=getPath().contents[$Tr.attr("id")];var aBase=String(window.location).split("/");aBase.pop();var sBase=aBase.join("/")+"/";var sFilePath=cleanUri((ss.copyRelative?"":sBase)+ss.prefx+ss.sfbpath+aPath.join("")+oExists.file);trace("sFilePath:",sFilePath);$Focused=$(":focus");$CopyPath.prependTo($Body).css({left:ss.x+"px",top:ss.y+"px"}).val(sFilePath).focus().select()}};var remCopyPath=function remCopyPath(){$CopyPath.blur().remove();$Focused.focus()};function sortFbTable(nr){if(nr!==undefined){iSort=nr;aSort[iSort]=aSort[iSort]=="asc"?"desc":"asc"}else{if(!aSort[iSort]){aSort[iSort]="asc"}}$TbBody.find("tr.folder").tsort("td:eq(0)[abbr]",{attr:"abbr",order:aSort[iSort]});$TbBody.find("tr:not(.folder)").tsort("td:eq("+iSort+")[abbr]",{attr:"abbr",order:aSort[iSort]});$SFB.find("thead>tr>th>span").each(function(i,o){$Span=$(this);if(i==iSort){$Span.addClass("sort")}else{$Span.removeClass("sort")}if(aSort[iSort]=="asc"){$Span.addClass("asc")}else{$Span.removeClass("asc")}})}function fillList(contents){trace("sfb fillist ",aPath);$TbBody.children().remove();$("#fbpreview").html("");aSort=[];var oCTree=getPath();oCTree.filled=true;if(ss.file!=""){var iSfbLn=0;var aSfbP=ss.sfbpath.split("/");$.each(aSfbP,function(i,s){if(s!=""){iSfbLn++}});var sPth="";$.each(aPath,function(i,sPath){sPth+=sPath+"///"});sPth=sPth.replace(/(\/+)/g,"/");aSPth=sPth.split("/");sRpth="";$.each(aSPth,function(i,sPath){if(i>=iSfbLn){sRpth+=sPath+"/"}});sRpth=sRpth.replace(/(\/+)/g,"/");var sSelFileName=ss.file.replace(sRpth,"");var aSeF=ss.file.split("/");var iDff=aSeF.length-aPath.length-1}$.each(contents,function(i,oFile){var bDir=(oFile.mime=="folder"||oFile.mime=="folderup");if((ss.allow.indexOf(oFile.mime)!=-1||ss.allow.length===0)&&ss.deny.indexOf(oFile.mime)==-1||bDir){if((bDir&&ss.dirs)||!bDir){var mTr=listAdd(oFile);if(ss.file!=""&&sSelFileName==oFile.file){mTr.animate({foo:1},{duration:1,complete:function(){mTr.mouseup(clickTrUp).mouseup();ss.file=""}})}}}});if(aPath.length>1&&!oCTree.contents[".."]){listAdd({file:"..",mime:"folderup",rsize:0,size:"-",time:0,date:""})}$SFBWin.find("thead>tr>th:eq(0)").trigger("click");applyToPlugins("fillList",[contents]);adjustFilenameWidth();if(ss.file!=""&&iDff>0){openDir(aSeF[aPath.length])}}function listAdd(obj,sort){getPath().contents[obj.file]=obj;var bUpload=obj.mime=="upload";var bFolder=obj.mime=="folder";var bUFolder=obj.mime=="folderup";var sMime=bFolder||bUFolder?gettext("folder"):obj.mime;var sTr='<tr id="'+obj.file+'" class="'+(bFolder||bUFolder?"folder":"file")+'">';var iHo=obj.mime.charCodeAt(0)-97;var iVo=obj.mime.charCodeAt(1)-97;switch(obj.mime){case"folder":iHo=26;iVo=2;break;case"folderup":iHo=28;iVo=2;break;case"odg":iHo=26;break;case"ods":iHo=27;break;case"odp":iHo=28;break}iHo*=-16;iVo*=-16;sTr+='<td abbr="'+obj.file+'" title="'+obj.file+'" class="icon" ><span class="icon" style="background-position: '+iHo+"px "+iVo+'px;" /><span class="filename">'+obj.file+"</span></td>";if(bUpload){sTr+='<td abbr="upload progress" colspan="4"><div class="progress"><div></div><span>0%</span><div></td>';sTr+='<td><a class="sfbbutton cancel" title="'+gettext("fileUploadCancel")+'"><span>'+gettext("fileUploadCancel")+"</span></a></td>"}else{sTr+='<td abbr="'+obj.mime+'">'+sMime+"</td>";sTr+='<td abbr="'+obj.rsize+'">'+obj.size+"</td>";sTr+='<td abbr="'+obj.time+'" title="'+obj.date+'">'+obj.date.split(" ")[0]+"</td>";var bVImg=(obj.width*obj.height)>0;sTr+=(bHasImgs?("<td"+(bVImg?(' abbr="'+(obj.width*obj.height)+'"'):"")+">"+(bVImg?(obj.width+"x"+obj.height+"px"):"")+"</td>"):"");sTr+="<td>";if(!(bFolder||bUFolder||bUpload)){sTr+='	<a onclick="" class="sfbbutton preview" title="'+gettext("view")+'">&nbsp;<span>'+gettext("view")+"</span></a>"}if(!(bUFolder||bUpload)){sTr+='	<a onclick="" class="sfbbutton filedelete" title="'+gettext("del")+'">&nbsp;<span>'+gettext("del")+"</span></a>"}sTr+="</td>"}sTr+="</tr>";$(document.getElementById(obj.file)).remove();var $Tr=$(sTr).prependTo($TbBody);obj.tr=$Tr;$Tr.find("a.filedelete").click(deleteFile);$Tr.find("a.preview").click(showFile);$Tr.find("a.cancel").click(function(e){$("#swfUploader").get(0).cancelUpload($(this).parent().parent().attr("id"));$Tr.remove()});$Tr.folder=bFolder||bUFolder;if(!bUpload){$Tr.mousedown(clickTrDown).mouseover(function(){$Tr.addClass("over")}).mouseout(function(){$Tr.removeClass("over")}).dblclick(function(e){chooseFile($(this))})}$Tr[0].oncontextmenu=function(e){return false};applyToPlugins("listAdd",[obj]);if(sort&&sort>0){aSort[iSort]=aSort[iSort]=="asc"?"desc":"asc";sortFbTable(iSort);$Tr.mousedown().mouseup();$TableH.scrollTop(0);$TbBody.scrollTop(0)}return $Tr}var bTrWasSelected=false;var bTrDownHasRenamed=false;var iTrDownT=0;function clickTrDown(e){var $Tr=$(e.currentTarget);$Tr.mouseup(clickTrUp);iTrDownT=new Date().getTime();if($Tr.hasClass("uploading")){return false}var oFile=file($Tr);var bUFolder=oFile.mime=="folderup";var bRight=e.button==2;var bCTRL=ss.keys[17];var bSelected=$Tr.hasClass("selected");bTrWasSelected=bSelected;var iTrY=$Tr[0].offsetTop;var iTbH=$TbBody.height();var iTsc=$TbBody.scrollTop();if(iTrY<iTsc||iTrY>(iTsc+iTbH)){var iAdd=iTrY-(iTsc+0.5*iTbH);var iScr=iTsc+iAdd;$("<br/>").animate({foo:1},{duration:0.1,complete:function(){$TbBody.scrollTop(iScr)}})}bTrDownHasRenamed=renameTryToPost()!==false;if(!bSelected&&!bCTRL){$TbBody.find("tr").removeClass("selected");if(!bUFolder){$Tr.toggleClass("selected")}}var iHTbl=$TableH.height();var iTrY=$Tr.position().top;if($TbBody.height()>iHTbl||$TbBody.get(0).scrollHeight!=iHTbl){var mScroll=jQuery.browser.mozilla?$TbBody:$TableH;if(iTrY>iHTbl||iTrY<0){var iDff=iTrY>iHTbl?(iTrY-iHTbl):(iTrY-2*$Tr.height());mScroll.scrollTop(mScroll.scrollTop()+iDff)}}oDragTr={screenX:e.screenX,screenY:e.screenY,pageX:e.pageX,pageY:e.pageY,offsetX:e.offsetX,offsetY:e.offsetY,layerX:e.layerX,layerY:e.layerY,clientX:e.clientX,clientY:e.clientY};$DragTr=$TbBody.find("tr.selected").add($Tr);$Document.mousemove(mouseMoveTr);$Document.mouseup(clearMoveTr)}function mouseMoveTr(e){var iDx=e.screenX-oDragTr.screenX;var iDy=e.screenY-oDragTr.screenY;var iD=Math.sqrt(iDx*iDx+iDy*iDy);if($DragTrTable===undefined&&iD>20){closeContext();$DragTrTable=$('<table id="sfbDragSelect"></table>').appendTo($SFB);$DragTrTable.append($DragTr.clone());$DragTrTable.find("td:not(:first-child)").remove();$DragTrTable.width("auto")}else{if($DragTrTable!==undefined){$DragTrTable.css({position:"absolute",left:e.clientX+"px",top:e.clientY+20+"px",zIndex:"500"})}}}function clearMoveTr(){$Document.unbind("mouseup",clearMoveTr);$Document.unbind("mousemove",mouseMoveTr);if($DragTrTable!==undefined){var $Rem=$DragTrTable.remove();$DragTrTable=undefined;var $ToTr=$Body.find("tr.over");if($ToTr.length>0){var oToFile=file($ToTr);if(oToFile.mime=="folder"||oToFile.mime=="folderup"){var sFiles="";$Rem.find("tr").each(function(i,el){var $Tr=$(el);var oFromFile=file($Tr);if(oFromFile.mime!="folderup"&&oFromFile!==oToFile){sFiles+=(sFiles==""?"":",")+oFromFile.file}});if(sFiles!=""){$.ajax({type:"POST",url:ss.conn,data:"a=moveFiles&folder="+aPath.join("")+"&file="+sFiles+"&nfolder="+oToFile.file,dataType:"json",error:onError,success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){trace(lang(data.error));trace(data.data);alert(lang(data.error))}else{trace(lang(data.msg));trace(data.data)}$.each(sFiles.split(","),function(i,s){$TbBody.find("tr").each(function(i,el){var $Tr=$(el);var sId=$Tr.attr("id");if(data.data.moved.indexOf(sId)!==-1){$Tr.remove();var oCurPath=getPath();var aNewPath=copy(aPath);if(data.data.newfolder==".."){aNewPath.pop()}else{aNewPath.push(data.data.newfolder+"/")}getPath(aNewPath).contents[sId]=oCurPath.contents[sId];delete oCurPath.contents[sId]}var a=oTree})})}}})}}}}}function clickTrUp(e){trace("clickTrUp\n\n");var $Tr=$(this);$Tr.unbind("mouseup");var iTrDownUpTime=new Date().getTime()-iTrDownT;if($Tr.hasClass("uploading")){return false}var oFile=file($Tr);var bUFolder=oFile.mime=="folderup";var bCTRL=ss.keys[17];var bSelected=$Tr.hasClass("selected");var bRight=e.button==2;clearMoveTr();if(bSelected&&!bCTRL){$TbBody.find("tr").removeClass("selected");if(!bUFolder){$Tr.addClass("selected")}}else{if(bCTRL&&!bUFolder){$Tr.toggleClass("selected")}}if(!bRight&&!bTrDownHasRenamed&&!bCTRL&&!bUFolder&&bTrWasSelected&&$Tr.hasClass("selected")&&iTrDownUpTime>200){renameAddInputField($Tr)}if(bRight){openContext($Tr,e.clientX-3,e.clientY-3)}else{closeContext()}previewFile($Tr);bTrWasSelected=false;bTrDownHasRenamed=false;return false}function chooseFile(el){var a=0;var aSelected=$TbBody.find("tr.selected");var aSelect=[];aSelected.each(function(i,o){if(i<ss.selectnum||ss.selectnum==0){aSelect.push(file(this))}});if(el&&el.find){aSelect.push(file(el))}for(var i=0;i<aSelect.length;i++){var oFile=aSelect[i];if(oFile.mime=="folder"){openDir(oFile.file);return false}else{if(oFile.mime=="folderup"){openDir();return false}}}aSelect=unique(aSelect);for(var i=0;i<aSelect.length;i++){var oFile=aSelect[i];var oDupl=new Object();for(var p in oFile){oDupl[p]=oFile[p]}aSelect[i]=oDupl}if(aSelect.length==0){alert(gettext("fileNotselected"))}else{if(ss.cookie){setSfbCookie()}$.each(aSelect,function(i,oFile){oFile.file=sReturnPath+aPath.join("").replace(ss.base,"")+oFile.file});var bSelect=ss.select(aSelect,ss.selectparams)!==false;if(bSelect&&bOverlay){closeSFB()}}}function openContext($Tr,x,y){var oFile=file($Tr);var bFolder=oFile.mime=="folder";var bUFolder=oFile.mime=="folderup";closeContext(function(){$Context.css({left:x,top:y});var oFld={display:bFolder||bUFolder?"none":"block"};$Context.find("li:has(a.preview)").css(oFld);$Context.find("li:has(a.duplicate)").css(oFld);var oFlu={display:!bUFolder?"block":"none"};$Context.find("li:has(a.rename)").css(oFlu);$Context.find("li:has(a.filedelete)").css(oFlu);applyToPlugins("checkContextItem",[oFile,$Context]);$Context.slideDown("fast")})}function closeContext(fnAfter){$Context.slideUp("fast",typeof(fnAfter)!="function"?function(){}:fnAfter)}function previewFile($Tr){var oFile=file($Tr);var sFile=oFile.file;if($("#fbpreview").length>0&&$("#fbpreview").attr("class")!=oFile.file){$("#fbpreview").html("");var iWprv=$("#fbpreview").width();var iHprv=$("#fbpreview").height();if(ss.img.indexOf(oFile.mime)!=-1){var sFuri=ss.prefx+ss.sfbpath+aPath.join("")+sFile;$('<img src="'+sFuri+"?"+Math.random()+'" />').appendTo("#fbpreview").click(function(){$(this).parent().toggleClass("auto")})}else{if(ss.ascii.indexOf(oFile.mime)!=-1||ss.archive.indexOf(oFile.mime)!=-1||oFile.mime=="pdf"){if(oFile.preview){$("#fbpreview").html(oFile.preview)}else{$("#fbpreview").html(gettext("previewText"));$.ajax({type:"POST",url:ss.conn,data:"a=read&folder="+aPath.join("")+"&file="+sFile,dataType:"json",error:onError,success:function(data,status){var sPrv="";if(typeof(data.error)!="undefined"){if(data.error!=""){trace("sfb error: ",lang(data.error));alert(lang(data.error))}else{if(data.data.type&&data.data.text){trace(lang(data.msg));var sMsg=data.data.type=="ascii"?gettext("previewPart").replace("#1",ss.previewbytes):gettext("previewContents");oFile.preview="<pre><div>"+sMsg+"</div>\n"+data.data.text.replace(/\>/g,"&gt;").replace(/\</g,"&lt;")+"</pre>";sPrv=oFile.preview}else{trace(lang(data.msg))}}}$("#fbpreview").html(sPrv)}})}}else{if(oFile.mime=="swf"||oFile.mime=="fla"){$("#fbpreview").html('<div id="previewFlash"></div>');swfobject.embedSWF(ss.sfbpath+aPath.join("")+sFile,"previewFlash",iWprv+"px",iHprv+"px","9.0.0","",{},{menu:"false"})}else{if(ss.movie.indexOf(oFile.mime)!=-1){$("#fbpreview").html('<div id="previewMovie"></div>');var sFuri=(oFile.mime=="mp3"?"":"../")+aPath.join("")+sFile;swfobject.embedSWF(ss.sfbpath+"css/splayer.swf","previewMovie",iWprv+"px",iHprv+"px","9.0.0","",{file:sFuri,width:iWprv,height:iHprv,gui:"playpause,scrubbar",guiOver:true,colors:'{"bg":"0xFFDEDEDE","bg1":"0xFFBBBBBB","fg":"0xFF666666","fg1":"0xFFD13A3A"}'},{menu:"false"})}}}}$("#fbpreview").attr("class",$("#fbpreview").html()==""?"":oFile.file);return true}return false}function openDir(dir){trace("sfb openDir ",dir," to ",ss.conn);if(dir){dir=String(dir+"/").replace(/(\/+)/gi,"/")}if(!dir||aPath[aPath.length-1]!=dir){if(dir){aPath.push(dir)}else{aPath.pop()}var oCTree=getPath();if(oCTree.filled){fillList(oCTree.contents)}else{$TbBody.html($TrLoading);trace("sfb calling fileList");$.ajax({type:"POST",url:ss.conn,data:"a=fileList&folder="+aPath.join(""),dataType:"json",error:onError,success:function(data,status){trace("sfb callback fileList");if(typeof(data.error)!="undefined"){if(data.error!=""){trace(lang(data.error));alert(lang(data.error))}else{trace(lang(data.msg));fillList(data.data)}}}})}applyToPlugins("openDir",[dir])}}function onError(req,status,err){trace("sfb ajax error ",req,status,err)}function duplicateFile(el){var oFile=file(el);var sFile=oFile.file;trace("sfb Sending duplication request...");$.ajax({type:"POST",url:ss.conn,data:"a=duplicate&folder="+aPath.join("")+"&file="+sFile,dataType:"json",error:onError,success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){trace(lang(data.error));alert(lang(data.error))}else{trace(lang(data.msg));listAdd(data.data,1).trigger("click")}}}})}function showFile(e){var mTr=$(e.target).parent().parent();var oFile=file(mTr);window.open(ss.conn+"?a=download&file="+aPath.join("")+oFile.file,"_blank")}function deleteFile(e){var mTr=$(e.target).parent().parent();var oFile=file(mTr);var bFolder=oFile.mime=="folder";if(confirm(bFolder?gettext("confirmDeletef"):gettext("confirmDelete"))){$.ajax({type:"POST",url:ss.conn,data:"a=delete&folder="+aPath.join("")+"&file="+oFile.file,dataType:"json",error:onError,success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){trace(lang(data.error));alert(lang(data.error))}else{trace(lang(data.msg));$("#fbpreview").html("");applyToPlugins("deleteFile",[e]);delete getPath().contents[oFile.file];mTr.remove()}}}})}e.stopPropagation()}function renameAddInputField(tr){var oFile=file(tr);if(oFile){var $Span=oFile.tr.find("td:eq(0)>span.filename");$Span.html("");var $Input=$('<input type="text" value="'+oFile.file+'" class="sfbrename" />').appendTo($Span).click(stopEvt).dblclick(stopEvt).mousedown(stopEvt).focus();adjustFilenameWidth();var iStart=0;var iPoint=oFile.file.indexOf(".");var iEnd=iPoint==-1?oFile.file.length:iPoint;mInput=$Input.get(0);if(mInput.createTextRange){var selRange=mInput.createTextRange();selRange.collapse(true);selRange.moveStart("character",iStart);selRange.moveEnd("character",iEnd-iStart);selRange.select()}else{if(mInput.setSelectionRange){mInput.setSelectionRange(iStart,iEnd)}else{if(mInput.selectionStart){mInput.selectionStart=iStart;mInput.selectionEnd=iEnd}}}shortcutsDisabled(true)}}function renameTryToPost(){var aRenamed=$TbBody.find("span.filename>input");if(aRenamed.length>0){var mInput=$(aRenamed[0]);var mSp=mInput.parent();var mTr=mSp.parents("tr:first");var oFile=file(mTr);var sFile=oFile.file;var sNFile=mInput.val();if(sFile==sNFile){mSp.html(sFile);shortcutsDisabled(false)}else{$.ajax({type:"POST",url:ss.conn,data:"a=rename&folder="+aPath.join("")+"&file="+sFile+"&nfile="+sNFile,dataType:"json",error:onError,success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){trace(lang(data.error));alert(lang(data.error));mSp.html(sFile)}else{trace(lang(data.msg));mSp.html(sNFile);oFile.file=sNFile}}shortcutsDisabled(false)}})}}return mTr?mTr:false}function addFolder(){trace("sfb addFolder");$.ajax({type:"POST",url:ss.conn,data:"a=addFolder&folder="+aPath.join("")+"&foldername="+gettext("newfolder"),dataType:"json",error:onError,success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){trace(lang(data.error));alert(lang(data.error))}else{trace(lang(data.msg));listAdd(data.data,1).trigger("click").trigger("click");sortFbTable();$("#sfbrowser #fbtable").scrollTop(0);$TbBody.scrollTop(0)}}}})}function fileUpload(){var sFile=$SFB.find("#fileToUpload").val();trace("sfb fileUpload ",sFile);if(sFile==""){return false}var sFileName=sFile.split("\\").pop();var oExists=getPath().contents[sFileName];if(oExists&&!confirm(gettext("fileExistsOverwrite"))){return false}$("#loadbar").ajaxStart(function(){trace("");$(this).show();loading()}).ajaxComplete(function(){$(this).hide()});ajaxFileUpload({url:ss.conn,secureuri:false,fileElementId:"fileToUpload",dataType:"json",success:function(data,status){if(typeof(data.error)!="undefined"){if(data.error!=""){trace("sfb error: ",lang(data.error));alert(lang(data.error))}else{if(oExists){oExists.tr.remove()}var mTr=listAdd(data.data,1);trace("sfb file uploaded: ",data.data.file,mTr[0].nodeName,mTr.attr("id"))}return false}},error:function(data,status,e){trace(e)}});return false}function loading(){var iPrgMove=Math.ceil((new Date()).getTime()*0.3)%512;$("#loadbar>div").css("backgroundPosition","0px "+iPrgMove+"px");$("#loadbar:visible").each(function(){setTimeout(loading,20)})}function applyToPlugins(sFunction,aParams){$.each(ss.plugins,function(i,sPlugin){if($.sfbrowser[sPlugin][sFunction]){$.sfbrowser[sPlugin][sFunction].apply(this,aParams)}})}function file(tr){if(!tr){tr=$TbBody.find("tr.selected:first")}return getPath().contents[$(tr).attr("id")]}function getPath(a){if(a===undefined){a=aPath}var oCTree=oTree;$.each(a,function(i,sPath){if(!oCTree[sPath]){oCTree[sPath]={contents:{},filled:false}}oCTree=oCTree[sPath]});return oCTree}function addContextItem(className,title,fnc,after){var mCItem=$('<li><a class="textbutton '+className+'" title="'+title+'"><span>'+title+"</span></a></li>");if(after===undefined){mCItem.appendTo("ul#sfbcontext").find("a").click(fnc).click(closeContext)}else{mCItem.insertAfter("ul#sfbcontext>li:eq("+after+")").find("a").click(fnc).click(closeContext)}return mCItem}function lang(s){var aStr=s.split("#");sReturn=gettext[aStr[0]]?gettext[aStr[0]]:s;if(aStr.length>1){for(var i=1;i<aStr.length;i++){sReturn=sReturn.replace("#"+i,aStr[i])}}return sReturn}function clearObject(o){for(var sProp in o){delete o[sProp]}}function isNum(n){return(parseFloat(n)+"")==n}var log=function log(){try{console.log.apply(console,arguments)}catch(e){}};var trace=function trace(){if(ss.debug===false){return}log.apply(this,arguments)};function gettext(s){return ss.lang[s]||s}function stopEvt(e){e.stopPropagation()}function shortcutsDisabled(set){if(set!==undefined&&set!==bShortcutsDisabled){bShortcutsDisabled=!!set}return bShortcutsDisabled}function resizeBrowser(){oConstraint.mxw=$Window.width();oConstraint.mxh=$Window.height();oConstraint.mxx=oConstraint.mxw-$SFBWin.width();oConstraint.mxy=oConstraint.mxh-$SFBWin.height();if($("#sfbrowser").length>0){if(bOverlay){if(oMaximized===undefined){var oPos=$SFBWin.position();var iRbX=Math.max(Math.min(oPos.left,oConstraint.mxx),oConstraint.mnx);var iRbY=Math.max(Math.min(oPos.top,oConstraint.mxy),oConstraint.mny);if(iRbX!=oPos.left||iRbY!=oPos.top){moveWindow(null,iRbX,iRbY)}var iRbW=Math.max(Math.min($SFBWin.width(),oConstraint.mxw),oConstraint.mnw);var iRbH=Math.max(Math.min($SFBWin.height(),oConstraint.mxh),oConstraint.mnh);if(iRbW<$SFBWin.width()||iRbH<$SFBWin.height()){resizeWindow(null,iRbW,iRbH)}}else{maximizeSFB(true)}}}}function moveWindowDown(e){var iXo=e.pageX-$(e.target).offset().left;var iYo=e.pageY-$(e.target).offset().top;$("body").mousemove(function(e){moveWindow(e,iXo,iYo)});$("body").mouseup(unbindBody)}function moveWindow(e,xo,yo){var mPrnO=$("#fbbg").offset();var iXps=Math.max(Math.min(e?e.pageX-xo-mPrnO.left:xo,oConstraint.mxx),oConstraint.mnx);var iYps=Math.max(Math.min(e?e.pageY-yo-mPrnO.top:yo,oConstraint.mxy),oConstraint.mny);$SFBWin.css({left:iXps+"px",top:iYps+"px"})}function resizeWindowDown(e){var iXo=e.pageX-$(e.target).offset().left;var iYo=e.pageY-$(e.target).offset().top;$("body").mousemove(function(e){resizeWindow(e,iXo,iYo)});$("body").mouseup(unbindBody);oMaximized=undefined}function resizeWindow(e,xo,yo){var oSPos=$SFB.position();var oWPos=$SFBWin.position();var iWdt=Math.max(Math.min(e?e.pageX+xo-(oWPos.left+oSPos.left):(xo?xo:$SFBWin.width()),oConstraint.mxw),oConstraint.mnw);var iHgt=Math.max(Math.min(e?e.pageY+yo-(oWPos.top+oSPos.top):(yo?yo:$SFBWin.height()),oConstraint.mxh),oConstraint.mnh);$SFBWin.css({width:iWdt+"px",height:iHgt+"px"});var iPrvH=$SFB.find("#fbpreview").height();var iAddH=iPrvH+(iPrvH==null?90:105);$TableH.css({height:(iHgt-iAddH+$Table.find("thead").height())+"px"});$TbBody.css({height:(iHgt-iAddH)+"px"});adjustFilenameWidth();if($Table.width()>$TableH.width()){$Table.find("tr").width($TableH.width())}applyToPlugins("resizeWindow",[iWdt,iHgt])}function maximizeSFB(force){if(oMaximized===undefined||force===true){oMaximized=$SFBWin.position();oMaximized.width=$SFBWin.width();oMaximized.height=$SFBWin.height();moveWindow(null,0,0);resizeWindow(null,$Window.width(),$Window.height())}else{moveWindow(null,oMaximized.left,oMaximized.top);resizeWindow(null,oMaximized.width,oMaximized.height);oMaximized=undefined}}function unbindBody(e){$("body").unbind("mousemove");$("body").unbind("mouseup");if(ss.cookie){setSfbCookie()}}function adjustFilenameWidth(){$Filename=$TbBody.find("span.filename");if(!$.browser.msie){$Filename.css({maxWidth:"auto"})}var iOverflow=$Table.width()-$TableH.width();for(var i=0;i<2;i++){var iWmx=$Filename.parents("td:first").width()-20-(i==0?1:0)*iOverflow;if(!$.browser.msie){$Filename.css({maxWidth:iWmx+"px"})}$Filename.find("input").css({width:iWmx+"px"})}}function getSfbCookie(){if(ss.cookie){var sCookie=readCookie($.sfbrowser.id);trace("sfb get cookie: "+sCookie);try{oCookie=eval("("+sCookie+")");ss.w=Math.min(Math.max(oCookie.w,oConstraint.mnw),oConstraint.mxw);ss.h=Math.min(Math.max(oCookie.h,oConstraint.mnh),oConstraint.mxh);oConstraint.mxx=$Window.width()-ss.w;oConstraint.mxy=$Window.height()-ss.h;ss.x=Math.min(Math.max(oCookie.x,oConstraint.mnx),oConstraint.mxx);ss.y=Math.min(Math.max(oCookie.y,oConstraint.mny),oConstraint.mxy)}catch(e){trace("sfb cookie error: "+sCookie);eraseCookie($.sfbrowser.id)}}else{eraseCookie($.sfbrowser.id)}return !!oCookie}function setSfbCookie(){var mBg=$("#fbbg");var oBPos=mBg.position();var oPos=$SFBWin.position();var sCval="{";sCval+='"path":["'+aPath.toString().replace(/,/g,'","')+'"]';if(bOverlay){sCval+=',"x":'+(oPos.left-oBPos.left);sCval+=',"y":'+(oPos.top-oBPos.top);sCval+=',"w":'+$SFBWin.width();sCval+=',"h":'+$SFBWin.height()}sCval+="}";trace("sfb set cookie: "+sCval);createCookie($.sfbrowser.id,sCval,356)}function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString()}else{var expires=""}document.cookie=name+"="+value+expires+"; path=/"}function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length)}}return null}function eraseCookie(name){createCookie(name,"",-1)}function cleanUri(path){path=path.replace(/(\/+)/g,"/").replace(/^\//g,"").replace(/tp:\//g,"tp://");while(true){var iLen=path.length;path=path.replace(/[\w_-]+\/\.\.\//g,"");if(iLen===path.length){break}}return path}function ajaxFileUpload(s){trace("sfb ajaxFileUpload");s=jQuery.extend({},jQuery.ajaxSettings,s);var iId=new Date().getTime();var sFrameId="jUploadFrame"+iId;var sFormId="jUploadForm"+iId;var sFileId="jUploadFile"+iId;var mForm=$('<form  action="" method="POST" name="'+sFormId+'" id="'+sFormId+'" enctype="multipart/form-data"><input name="a" type="hidden" value="upload" /><input name="folder" type="hidden" value="'+aPath.join("")+'" /><input name="allow" type="hidden" value="'+ss.allow.join("|")+'" /><input name="deny" type="hidden" value="'+ss.deny.join("|")+'" /><input name="resize" type="hidden" value="'+ss.resize+'" /></form>').appendTo("body").css({position:"absolute",top:"-1000px",left:"-1000px"});$("#"+s.fileElementId).before($("#"+s.fileElementId).clone(true).val("")).attr("id",s.fileElementId).appendTo(mForm);var mIframe=$('<iframe id="'+sFrameId+'" name="'+sFrameId+'"  src="'+(typeof(s.secureuri)=="string"?s.secureuri:"javascript:false")+'" />').appendTo("body").css({position:"absolute",top:"-1000px",left:"-1000px"});var mIframeIO=mIframe[0];if(s.global&&!jQuery.active++){jQuery.event.trigger("ajaxStart")}var requestDone=false;var xml={};if(s.global){jQuery.event.trigger("ajaxSend",[xml,s])}var uploadCallback=function(isTimeout){var mIframeIO=document.getElementById(sFrameId);try{if(mIframeIO.contentWindow){xml.responseText=mIframeIO.contentWindow.document.body?mIframeIO.contentWindow.document.body.innerHTML:null;xml.responseXML=mIframeIO.contentWindow.document.XMLDocument?mIframeIO.contentWindow.document.XMLDocument:mIframeIO.contentWindow.document}else{if(mIframeIO.contentDocument){xml.responseText=mIframeIO.contentDocument.document.body?mIframeIO.contentDocument.document.body.innerHTML:null;xml.responseXML=mIframeIO.contentDocument.document.XMLDocument?mIframeIO.contentDocument.document.XMLDocument:mIframeIO.contentDocument.document}}}catch(e){jQuery.handleError(s,xml,null,e)}if(xml||isTimeout=="timeout"){requestDone=true;var status;try{status=isTimeout!="timeout"?"success":"error";if(status!="error"){var data=uploadHttpData(xml,s.dataType);if(s.success){s.success(data,status)}if(s.global){jQuery.event.trigger("ajaxSuccess",[xml,s])}}else{jQuery.handleError(s,xml,status)}}catch(e){status="error";jQuery.handleError(s,xml,status,e)}if(s.global){jQuery.event.trigger("ajaxComplete",[xml,s])}if(s.global&&!--jQuery.active){jQuery.event.trigger("ajaxStop")}if(s.complete){s.complete(xml,status)}mIframe.unbind();setTimeout(function(){try{mIframe.remove();mForm.remove()}catch(e){jQuery.handleError(s,xml,null,e)}},100);xml=null}};if(s.timeout>0){setTimeout(function(){if(!requestDone){uploadCallback("timeout")}},s.timeout)}try{mForm.attr("action",s.url).attr("method","POST").attr("target",sFrameId).attr("encoding","multipart/form-data").attr("enctype","multipart/form-data").submit()}catch(e){jQuery.handleError(s,xml,null,e)}mIframe.load(uploadCallback);return{abort:function(){}}}function uploadHttpData(r,type){var data=!type;data=type=="xml"||data?r.responseXML:r.responseText;if(data){switch(type){case"script":jQuery.globalEval(data);break;case"json":eval("data = "+data);break;case"html":jQuery("<div>").html(data).evalScripts();break;default:}}return data}$.sfb=$.fn.sfbrowser})(jQuery);var height_=jQuery.fn.height;jQuery.fn.height=function(){if(this[0]==window&&jQuery.browser.opera&&jQuery.browser.version>=9.5){return window.innerHeight}else{return height_.apply(this,arguments)}};function unique(c){var d=[],e;c.sort();for(e=0;e<c.length;e++){if(c[e]!==c[e+1]){d[d.length]=c[e]}}return d}function copy(c){var d=[],e=c.length;while(e--){d[e]=c[e].constructor===Array?copy(c[e]):c[e]}return d}if(!Array.indexOf){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]===b){return a}}return -1}}function format_size(c,a){if(!a){a=0}aSize=["B","kB","MB","GB","TB","PB","EB","ZB","YB"];for(var b=0;c>1024&&aSize.length>b;b++){c/=1024}return Math.round(c,a)+aSize[b]};