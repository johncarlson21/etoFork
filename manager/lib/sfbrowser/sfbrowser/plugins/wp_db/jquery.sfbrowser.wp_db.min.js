(function(g){var x;var D;var c;var I;var A;var j;var b;var o;var q;var v;var u;var h;var i;var a;var B;var G;var n;var E;var t;var w;var l;var s;var p;var C;var e;var H="wpdb";var y="inwpdb";var F="qwer";var d;var z;var m;g.fn.extend(g.sfbrowser,{wp_db:function(J){x=J.trace;D=J.file;c=J.getPath;I=J.lang;A=J.gettext;j=J.onError;q=J.addContextItem;v=J.sortFbTable;u=J.aPath;i=J.oTree;h=J.oSettings;a=J.oReg;moveWindowDown=J.moveWindowDown;b=J.fillList;o=J.listAdd;q=J.addContextItem;G=J.$Document;n=J.$Window;E=J.$Body;t=J.$SFB;w=J.$SFBWin;l=J.$TableH;s=J.$Table;p=J.$TbBody;C=J.$TrLoading;e=J.$Context;d=h.sfbpath+"plugins/wp_db/connectors/"+h.connector+"/wp_db."+h.connector;var K=l.find("th.buttons");z=K.parent().children().index(K);m=q(H,A("remFromWPlib"),function(L){f(D())},5)}});g.extend(g.sfbrowser.wp_db,{fillList:function(K){var J={};var L=0;g.each(K,function(N,P){var M=P.mime=="upload";var O=P.mime=="folder";var Q=P.mime=="folderup";if(!(M||O||Q)&&P.wpPostsId===undefined){P.wpPostsId=0;J[N]=P.file;L++}});if(L!==0){g.ajax({type:"POST",url:d,data:"a=inDB&folder="+u.join("")+"&files="+JSON.stringify(J),dataType:"json",error:j,success:function(O,M){var N=c().contents;g.each(O.data,function(P,R){var Q=N[P];Q.wpPostsId=R;Q.tr.find("a."+H).addClass(y).attr("title",A("isInWPlib"))})}})}},listAdd:function(P){var L=P.mime=="upload";var N=P.mime=="folder";var Q=P.mime=="folderup";if(!(L||N||Q)){var O=P.tr;var J=O.find("td:eq("+z+")");var K=A("clickAddToWPlib");var M=g('<a onclick="" class="sfbbutton '+H+(P.wpPostsId?" "+y:"")+'" title="'+K+'">&nbsp;<span>'+K+"</span></a>").prependTo(J);M.click(function(R){f(P)})}},deleteFile:function(L){var J=g(L.target).parent().parent();var K=D(J);if(K.wpPostsId){k(K,A("alsoDelFromWPlib"))}},checkContextItem:function(P,L){var K=P.wpPostsId!==undefined;m.css({display:K?"block":"none"});if(K){var M=P.wpPostsId>0;var N=!M?A("addToWPlib"):A("remFromWPlib");var J=!M?A("addToDB"):A("remFromDB");var O=m.find("a");O.attr("title",N).find("span").html(J);if(M){O.addClass(y)}else{O.removeClass(y)}}}});function f(J){if(J.wpPostsId>0){k(J,A("remFromWPlibLinked"))}else{r(J,A("addToWPlib"))}}function k(J,K){if(confirm(K)){g.ajax({type:"POST",url:d,data:"a=remDB&folder="+u.join("")+"&id="+J.wpPostsId,dataType:"json",error:j,success:function(N,M){if(N.error==""){var L=c();g.each(N.data,function(P,O){x("filename: "+O,true);var Q=L.contents[O];Q.tr.find("a.wpdb").removeClass(y);Q.wpPostsId=0})}}})}}function r(J,K){if(confirm(K)){x();g.ajax({type:"POST",url:d,data:"a=addDB&folder="+u.join("")+"&file="+J.file,dataType:"json",error:j,success:function(N,M){if(N.error==""){var L=c();J.tr.find("a.wpdb").addClass(y);J.wpPostsId=N.data.postid;if(N.data.files){g.each(N.data.files,function(P,Q){x("file.wpPostsId: "+J);x(Q);Q.wpPostsId=N.data.postid;var O=o(Q);O.find("a.wpdb").addClass(y)});v()}}}})}}})(jQuery);